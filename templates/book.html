{% extends 'base.html' %}
{% block content %}

{% if session.user == "admin" %}

<div class="container row s12 m8 l6 offset-l3 offset-m2 card hoverable">
    <div class="card-content action-card-container">
        <div class="center-align row s12 admin-controls">
            <span><a class="btn red modal-trigger" href="#delete-confirmation">Delete book</a></span>
            <span><a href="{{ url_for("edit_book", book_id=book._id)}}" class="btn blue">Edit book</a></span>
        </div>
    </div>
</div>

<!-- Delete confirmation modal content -->
<div class="modal center-align" id="delete-confirmation">
    <div class="modal-content">
        <p class="flow-text">Are you sure you want to delete {{ book.title }}?</p>
        <a href="{{ url_for("delete_book", book_id=book._id)}}" class="btn-large red">Confirm</a>
    </div>
</div>

{% endif %}

<div class="row s12">
    <div class="card horizontal row">
        <div class=" col s3 card-image valign-wrapper">
            <img src="{{ book.image_url }}" alt="{{ book.title }}">
        </div>
        <div class="card-stacked col s9">
            <div class="card-content">
                <h4 class="flow-text">{{ book.title }}</h4>
                <div class="valign-wrapper">
                    {% if book.ratings %}
                    {% for i in range(0, book.ratings) %}
                    <span><i class="material-icons yellow-text">star</i></span>
                    {% endfor %}
                    <span>{{ book.ratings }}</span>
                    {% else %}
                    <span><i class="material-icons yellow-text">star_border</i></span>
                    <span>No current ratings</span>
                    {% endif %}
                </div>
                <em class="flow-text">{{ book.author }}</em>
                <p>{{ book.summary }}</p>
            </div>
        </div>
    </div>
</div>

{% if session.user %}

<div class="container hoverable row s12 m8 l6 offset-l3 offset-m2 card">
    <div class="action-card-container">
        <div class="center-align row s12">
            <h5 class="inline white center-align">What did you think of <br><em>"{{book.title}}"?</em></h5>
        </div>
        <div class="center-align row s12">
            <a class="btn red darken-2 hoverable modal-trigger" href="#write-review">Add a review
                <i class="material-icons right">rate_review</i>
            </a>
        </div>
    </div>
</div>

{% else %}

<div class="container hoverable row s12 m8 l6 offset-l3 offset-m2 card">
    <div class="action-card-container">
        <div class="center-align row s12">
            <h5 class="inline white center-align">Login to add a review</em></h5>
        </div>
        <div class="center-align row s12">
            <a class="btn red darken-2 hoverable modal-trigger" href="{{ url_for("login")}}">login
                <i class="material-icons right">rate_review</i>
            </a>
        </div>
    </div>
</div>

{% endif %}

<ul class="row collapsible popout">
    {% for review in book.reviews %}
    <li>
        <div class="collapsible-header">{{ review.author }} {{ review.rating }}
            {% for i in range(0, review.rating) %}
            <span><i class="material-icons yellow-text">star</i></span>
            {% endfor %}
        </div>
        <div class="collapsible-body">{{ review.review }}</div>
    </li>

    {% endfor %}
</ul>

<div id="write-review" class="modal">
    <div class="modal-content white">
        <h5 class="inline center-align">What did you think of <br><em>"{{book.title}}"?</em></h5>
        <form method="POST" action="{{ url_for("add_review", book_id=book._id) }}">
            <div class="row center-align">
                <!-- review body -->
                <div class="input-field col s12">
                    <i class="material-icons prefix">rate_review</i>
                    <textarea id="review-body" name="review-body" placeholder="Let us know what you think"
                        class="materialize-textarea" rows="20" required></textarea>
                    <label for="review">Review</label>
                </div>
                <!-- star rating: Interactive star rating made by Jordan-Simonds (https://codepen.io/jexordexan/pen/yyYEJa)-->
                <div class="star-container row">
                    <input class="star star-5" id="star-5" type="radio" name="star" value="5" required />
                    <label class="star star-5" for="star-5"></label>
                    <input class="star star-4" id="star-4" type="radio" name="star" value="4" />
                    <label class="star star-4" for="star-4"></label>
                    <input class="star star-3" id="star-3" type="radio" name="star" value="3" />
                    <label class="star star-3" for="star-3"></label>
                    <input class="star star-2" id="star-2" type="radio" name="star" value="2" />
                    <label class="star star-2" for="star-2"></label>
                    <input class="star star-1" id="star-1" type="radio" name="star" value="1" />
                    <label class="star star-1" for="star-1"></label>
                </div>
                <input type="hidden" id="user" name="user" value="{{ session.user }}" </div> <div
                    class="row center-align">
                <em> by {{session.user}} </em>
            </div>
            <!-- submit -->
            <div class="center-align">
                <button class="btn red darken-2" type="submit" name="add_review">Submit
                    <i class="material-icons right">create</i>
                </button>
            </div>
        </form>
    </div>
</div>

{% endblock content %}